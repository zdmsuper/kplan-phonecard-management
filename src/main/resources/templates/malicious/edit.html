<!--_meta 作为公共模版分离出去-->
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport"
	content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<link rel="Bookmark" href="/favicon.ico">
<link rel="Shortcut Icon" href="/favicon.ico" />
<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5shiv.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>
<![endif]-->
<link rel="stylesheet" type="text/css"
	th:href="@{/ui/h-ui/css/H-ui.min.css}" href="ui/h-ui/css/H-ui.min.css" />
<link rel="stylesheet" type="text/css"
	th:href="@{/ui/h-ui.admin/css/H-ui.admin.css}"
	href="ui/h-ui.admin/css/H-ui.admin.css" />
<link rel="stylesheet" type="text/css"
	th:href="@{/lib/Hui-iconfont/1.0.8/iconfont.css}"
	href="lib/Hui-iconfont/1.0.8/iconfont.css" />
<link rel="stylesheet" type="text/css"
	th:href="@{/ui/h-ui.admin/skin/default/skin.css}"
	href="ui/h-ui.admin/skin/default/skin.css" id="skin" />
<link rel="stylesheet" type="text/css"
	th:href="@{/ui/h-ui.admin/css/style.css}"
	href="ui/h-ui.admin/css/style.css" />
<!--[if IE 6]>
<script type="text/javascript" src="lib/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script>
<![endif]-->
<!--/meta 作为公共模版分离出去-->
<title>添加用户 - H-ui.admin v3.1</title>
<meta name="keywords"
	content="H-ui.admin v3.1,H-ui网站后台模版,后台模版下载,后台管理系统模版,HTML后台模版下载">
<meta name="description"
	content="H-ui.admin v3.1，是一款由国人开发的轻量级扁平化网站后台模板，完全免费开源的网站后台管理系统模版，适合中小型CMS后台系统。">
</head>
<body>
	<article class="page-container">
		<form method="post" class="form form-horizontal" id="form"
			autocomplete="off">
			<!-- 			<input type="hidden" name="id" th:value="${item.id}"> -->
			<div class="row cl">
				<label class="form-label col-xs-2 col-sm-3"><span
					class="c-red">*</span>联系号码：</label>
				<div class="formControls col-xs-2 col-sm-3">
					<input type="text" class="input-text" name="re_phone" id="re_phone"
						th:value="${order.phone_num}">
				</div>
				<label class="form-label col-xs-1 col-sm-2">
				<span
					class="c-red">*</span>用户姓名：
					</label>
					<div class="formControls col-xs-2 col-sm-3">
					<input type="hidden" th:value="${order.id}" id="orderNo" name="orderNo"> <input
						type="text" class="input-text" th:value="${order.user_name}"
						placeholder="" id="userName" name="userName">
				</div>
			</div>
			<div class="row cl">
				<label class="form-label col-xs-4 col-sm-3"><span
					class="c-red">*</span>恶意标签：</label>
				<div class="formControls col-xs-4 col-sm-5">
					<input type="text" class="input-text"
						th:value="${order.malicious_order}" style="color: red;" placeholder="" id=""
						readonly="readonly" name="">
				</div>
			</div>
			<div class="row cl">
				<label class="form-label col-xs-2 col-sm-3"><span
					class="c-red">*</span>身份证号码：</label>
				<div class="formControls col-xs-2 col-sm-3">
					<input type="text" class="input-text"
						th:value="${order.user_id}" placeholder="" id="userid"
						name="userid">
				</div>
				
				<label class="form-label col-xs-1 col-sm-2"><span
					class="c-red">*</span>产&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;品：</label>
					<div class="formControls col-xs-2 col-sm-3">
					<select class="select select-box inline" lay-verify="required" style="width: 50" name="procDuctName" id="ordersource">
							<option value="">未匹配到产品</option>
							<option th:each="product:${product}"
								th:value="${product.procduct_code}"
								th:text="${product.procduct_name}" 
								th:selected="${order.procduct_name==product.procduct_name}">&nbsp;</option>
					</select>
				
			</div>

			</div>


			<div class="row cl">
				<label class="form-label col-xs-4 col-sm-3"><span
					class="c-red">*</span>地&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;区：</label>
				<div id="province"
					class="formControls col-xs-8 col-sm-9 skin-minimal">

					<select style="width: 50" id="province_code"
						class="select select-box inline" name="provinceCode">
						<option value="">请选择</option>
						<option th:each="channel:${province}"
							th:value="${channel.province_code}"
							th:text="${channel.province_name}"
							th:selected="${order.post_province==channel.province_name}">&nbsp;</option>
					</select> <select class="select select-box inline" style="width: 50"
						id="city" name="cityCode">
						<option value="">请选择</option>
						<option th:each="channel:${city}" th:value="${channel.city_code}"
							th:text="${channel.city_name}"
							th:selected="${order.post_city==channel.city_name}"></option>
					</select> <select style="width: 50" class="select select-box inline"
						id="district" name="districtCode">
						<option value="">请选择</option>
						<option th:each="channel:${disr}" th:value="${channel.id}"
							th:text="${channel.district_name}"
							th:selected="${order.post_district==channel.district_name}"></option>
					</select>
				</div>
			</div>
			<div class="row cl">
				<label class="form-label col-xs-4 col-sm-3"><span
					class="c-red">*</span>详细地址：</label>
				<div class="formControls col-xs-8 col-sm-9">
					<input type="text" class="input-text"
						th:value="${order.distribution_addres}" placeholder="" id="address"
						name="address">
				</div>
			</div>

			<div></div>
		<div class="row cl">
				<label class="form-label col-xs-4 col-sm-3"><span
					class="c-red">*</span>短&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;信：</label>
				<div class="formControls col-xs-8 col-sm-9">
					<input type="radio" class="radio-box" name="smsstatus"  value="1">发送
					<input type="radio" class="radio-box" name="smsstatus" checked="checked" value="2">不发送
				</div>
			</div>
			<div class="row cl">
				<label class="form-label col-xs-2 col-sm-3"><span
					class="c-red">*</span>订&nbsp;&nbsp;单&nbsp;&nbsp;号：</label>
				<div class="formControls col-xs-2 col-sm-3">
					<input type="text" class="input-text"
						th:value="${order.order_no}" placeholder="" id=""
						readonly="readonly" name="">
				</div>
				
				<label class="form-label col-xs-1 col-sm-2"><span
					class="c-red">*</span>订购号码：</label>
				<div class="formControls col-xs-2 col-sm-3">
					<input type="text" class="input-text" 
						name="phone_Num" id="phone_Num"
						>
				</div>
			</div>
			
			
			<div class="row cl">
				<label class="form-label col-xs-2 col-sm-3"><span
					class="c-red">*</span>处理方式：</label>
				<div class="formControls col-xs-2 col-sm-3">
					<select class="select select-box inline" name="proctype"
						id="proctype">
						<option value="">请选择</option>
						<option value="1">办理</option>
						<option value="4">二次回访</option>
						<option value="6">三次回访</option>
						<option value="7">多次联系不上</option>
						<option value="2">不办理</option>
						<option value="8">不符合回访</option>
<!-- 						<option value="3">转运营</option> -->
					</select>
				</div>
				
				
				<label class="form-label col-xs-1 col-sm-2"><span
					class="c-red"></span>尾号搜索：</label>
				<div class="formControls col-xs-2 col-sm-3">
					<input type="text" style="width: 20;" class="input-text"  name="basicUserInfo.email" id="phoneNum" >
					<input type="button" class="btn btn-primary radius" id="id-disable-check" value="搜索" /> 
				</div>
			</div>
			
			<div class="row cl">
				<label class="form-label col-xs-4 col-sm-3">
				<select style="width: 50"  class="select select-box inline" id="phoneRule" name="phoneRule" >
							<option value="">请选择</option>
							<option th:each="channel:${phoneRuleList}"
								th:value="${channel.rule_name}"
								th:text="${channel.rule_name}" >&nbsp;</option>
						</select>
				<input type="button" class="btn btn-primary radius" id="phonescheck" value="换一批">
				</label>
				<div class="formControls col-xs-8 col-sm-9">
					<table
					class="table table-border table-bordered table-hover table-bg table-sort">
					<thead style="text-align: center;">
						<tr >
							<th style="text-align: center;">
<!-- 							<input type="radio" name="" value=""> -->
							</th>
							<th style="text-align: center;">靓号</th>
							<th style="text-align: center;">规则</th>
							<th style="text-align: center;">省份</th>
							<th style="text-align: center;">城市</th>
							<th style="text-align: center;">更新时间</th>
						</tr>
					</thead>
					<tbody id='phones' th:each="phones:${phoneList}">
						<tr class="text-c" >
						<td><input type="radio" th:value="${phones.phone}" name="phonesNum"/></td>
							<td  th:text="${phones.phone}">暂无靓号</td>
							<td th:text="${phones.rule_name}">暂无靓号</td>
							<td th:text="${phones.province_name}">暂无靓号</td>
							<td th:text="${phones.city_name}">暂无靓号</td>
							<td th:text="${phones.last_date}">暂无靓号</td>
						</tr>
					</tbody>
				</table>
				</div>
			</div>
			
			
			
			<div class="row cl">
				<label class="form-label col-xs-4 col-sm-3">备注：</label>
				<div class="formControls col-xs-8 col-sm-9">
					<textarea name="remarks" id="remark" cols="" rows="" 
						class="textarea" placeholder="说点什么...最少输入10个字符"
						onKeyUp="$.Huitextarealength(this,100)" th:text="${order.remarks}">
						</textarea>
					<p class="textarea-numberbar">
						<em class="textarea-length">0</em>/100
					</p>
				</div>
			</div>

			<div class="row cl">
				<div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-3">
					<input class="btn btn-primary radius" type="button" id="saveBtn"
						value="&nbsp;&nbsp;提交&nbsp;&nbsp;">
				</div>
			</div>
		</form>
	</article>

	<!--_footer 作为公共模版分离出去-->
	<script type="text/javascript"
		th:src="@{/lib/jquery/1.9.1/jquery.min.js}"
		src="lib/jquery/1.9.1/jquery.min.js"></script>
	<script type="text/javascript" th:src="@{/lib/layer/2.4/layer.js}"
		src="lib/layer/2.4/layer.js"></script>
	<script type="text/javascript" th:src="@{/ui/h-ui/js/H-ui.min.js}"
		src="ui/h-ui/js/H-ui.min.js"></script>
	<script type="text/javascript"
		th:src="@{/ui/h-ui.admin/js/H-ui.admin.js}"
		src="ui/h-ui.admin/js/H-ui.admin.js"></script>
	<!--/_footer 作为公共模版分离出去-->

	<!--请在下方写此页面业务相关的脚本-->
	<script type="text/javascript"
		th:src="@{/lib/jquery.validation/1.14.0/jquery.validate.js}"
		src="lib/jquery.validation/1.14.0/jquery.validate.js"></script>
	<script type="text/javascript"
		th:src="@{/lib/jquery.validation/1.14.0/validate-methods.js}"
		src="lib/jquery.validation/1.14.0/validate-methods.js"></script>
	<script type="text/javascript"
		th:src="@{/lib/jquery.validation/1.14.0/messages_zh.js}"
		src="lib/jquery.validation/1.14.0/messages_zh.js"></script>
	<script type="text/javascript">
		$(function() {
			$('.skin-minimal input').iCheck({
				checkboxClass : 'icheckbox-blue',
				radioClass : 'iradio-blue',
				increaseArea : '20%'
			});
			$(".file-2").change(function() {
				console.info(1)
			});
			$("#headImg").change(function() {
				console.info(2)
			});
			$("#headImg").change(
					function() {
						$("#img").attr("src",
								URL.createObjectURL($(this)[0].files[0]));
					});
			function validateForm() {
				return $("#form").validate({
					rules : {
						'userName' : {
							required : true,
							minlength : 2,
							maxlength : 16
						},
						'userid' : {
							required : true,
						},
						'address' : {
							required : true,
							isMobile : true,
						},
						'province_code' : {
							required : true,
							province_code : true,
						},
						'district' : {
							required : true,
							district : true,
						},
						'city' : {
							required : true,
							city : true,
						},
						're_phone' : {
							required : true,
							re_phone : true,
						},
						'phone_Num' : {
							required : true,
							phone_Num : true,
						},

					},
					onkeyup : false,
					focusCleanup : true,
					success : "valid"
				}).form();

			}

			$('#saveBtn')
					.click(
							function() {
								$('#saveBtn').attr('disabled',true);
								var formData = new FormData($('#form')[0]); 
								var url = "/malicious/procOrder";
								var orderNo = $('#orderNo').val();
								var userName = $('#userName').val()
								var userid = $('#userid').val()
								var address = $('#address').val()
								var province = $('#province_code').find(
										"option:selected").text();
								var provinceCode = $('#province_code').find(
										"option:selected").val();
								var city = $('#city').find("option:selected")
										.text();
								var cityCode = $('#city').find(
										"option:selected").val();
								var district = $('#district').find(
										"option:selected").text();
								var districtCode = $('#district').find(
										"option:selected").val();
								var re_phone = $('#re_phone').val();
								var Productname = $('#procductName').val()
								var proctype = $('#proctype').val();
								var proctypeText = $('#proctype').find(
										"option:selected").text();
								var remark=$('#remark').val();
								var pramStr = "orderNo=" + orderNo
										+ "&userName=" + userName + "&userid="
										+ userid + "&address=" + address
										+ "&province=" + province
										+ "&Productname=" + Productname
										+ "&re_phone=" + re_phone
										+ "&proctype=" + proctype
										+ "&cityCode=" + cityCode + "&city="
										+ city + "&province=" + province
										+ "&provinceCode=" + provinceCode
										+ "&district=" + district
										+ "&districtCode=" + districtCode+"&remark="+remark;
								var submitMsg = "用户名：" + userName
										+ "<br/> 身份证：" + userid + "<br/> 地区："
										+ province + "&nbsp;" + city + "&nbsp;"
										+ district + "<br/> 详细地址：" + address
										+ "<br/>联系电话：" + re_phone
										+ "<br/>产品名称：" + Productname
										+ "<br/>处理方式：" + proctypeText;
								if (userName == '' || userid == ''
										|| address == '' || re_phone == ''
										|| provinceCode == '' || cityCode == ''
										|| districtCode == '') {
									layer.msg('请将订单信息填写完整', {
										time : 5000, //20s后自动关闭
										btn : [ '确定' ]
									});
									return;
								}
								if (proctype == '') {
									layer.msg('请选择处理方式', {
										time : 5000, //20s后自动关闭
										btn : [ '确定' ]
									});
									return;
								}
								
								
								$.ajax({
									type:'post',
									async:true,
									url:url,
									data: formData, 
								  	cache: false, 
								  	processData: false, 
								  	contentType: false, 
									success : function(resp) {
										if (resp.status == 200) {
											layer.msg(resp.msg, {
												icon : 1,
												time : 3000
											//2秒关闭（如果不配置，默认是3秒）
											}, function() {
												window.parent.location
														.reload()

											});
										} else {

											parent.layer.alert(resp.msg,
													'提示信息')
										}

									}
								});
								

// 								layer.confirm(submitMsg, {
// 									btn : [ '确定提交', '取消' ]
// 								//按钮
// 								}, function() {
									
// 								}, function() {
// 									layer.msg('订单已取消提交', {
// 										time : 1000, //20s后自动关闭
// 										//					    btn: ['明白了', '']
// 									});
// 								});

							});

		});

		$('#province_code')
				.change(
						function() {
							var province = $(this).val();
							var city = $('#city');
							$('#city option[value!=""]').remove();
							$('#district option[value!=""]').remove();
							var url = "/coreorder/qryCity";
							$
									.ajax({
										type : 'get',
										url : url + '?province_code='
												+ province,
										success : function(resp) {
											$
													.each(
															resp,
															function() {
																city
																		.append('<option  value='+this.city_code+'>'
																				+ this.city_name
																				+ '</option>');

															});

										}
									});
						});

		$('#city').change(
				function() {
					var city_code = $(this).val();
					var city = $('#district');
					$('#district option[value!=""]').remove();
					var url = "/coreorder/qryDistrict";

					// 				/*[[@{/klanBiliBili/qryDistrict}]]*/'';
					var cityList = [];
					$.ajax({
						type : 'get',
						async : false,
						url : url + '?city_code=' + city_code,
						success : function(resp) {
							cityList = resp;
						}
					});
					$.each(cityList, function() {
						city.append('<option value='+this.district_code+'>'
								+ this.district_name + '</option>');

					});
				});

		function formatTime(time, shu) {//时间切换
			if (!time) {
				return

			}
			const timer = new Date(time)
			let year = timer.getFullYear()
			let month = timer.getMonth() + 1
			let date = timer.getDate()
			let hours = timer.getHours()
			let min = timer.getMinutes()
			let second = timer.getSeconds()
			month < 10 ? month = `0${month}` : month = month
			date < 10 ? date = `0${date}` : date = date
			hours < 10 ? hours = `0${hours}` : hours = hours
			min < 10 ? min = `0${min}` : min = min
			if (shu == 1) {
				return ` ${month}-${date} ${hours}:${min}`
			} else {
				return `${year} ${month}-${date} ${hours}:${min}:${second}`
			}
		}

		$('#phoneRule')
				.change(
						function() {
							var phones = $('#phones');
							var phoneRule = $('#phoneRule').val();
							var procductCode = $('#ordersource').val();
							var province=$('#province_code').find("option:selected").val()
							var url = "/coreorder/qryPhones"
							//	 			/*[[@{/klanBiliBili/qryPhones}]]*/'';
							var phone = [];
							$.ajax({
								type : 'get',
								async : false,
								url : url + "?phoneRule=" + phoneRule
										+ "&procductCode=" + procductCode+"&province="+province,
								success : function(resp) {
									phone = resp;
								}
							});
							$('.text-c').remove();
							$
									.each(
											phone,
											function() {
												var dateStr = formatTime(this.last_date)
												phones
														.append('<tr class="text-c"><td><input type="radio" value="'+this.phone+'"  name="phonesNum"/></td><td>'
																+ this.phone
																+ '</td><td>'
																+ this.rule_name
																+ '</td><td>'
																+ this.province_name
																+ '</td><td>'
																+ this.city_name
																+ '</td><td>'
																+ dateStr
																+ '</td></tr>');

											});
						});

		$('#ordersource')
				.change(
						function() {
							var phones = $('#phones');
							var phoneRule = $('#phoneRule').val();
							var procductCode = $('#ordersource').val();
							var url = "/coreorder/qryPhones"
							//	 			/*[[@{/klanBiliBili/qryPhones}]]*/'';
							var phone = [];
							$.ajax({
								type : 'get',
								async : false,
								url : url + "?phoneRule=" + phoneRule
										+ "&procductCode=" + procductCode,
								success : function(resp) {
									phone = resp;
								}
							});
							$('.text-c').remove();
							$
									.each(
											phone,
											function() {
												var dateStr = formatTime(this.last_date)
												phones
														.append('<tr class="text-c"><td><input type="radio" value="'+this.phone+'"  name="phonesNum"/></td><td>'
																+ this.phone
																+ '</td><td>'
																+ this.rule_name
																+ '</td><td>'
																+ this.province_name
																+ '</td><td>'
																+ this.city_name
																+ '</td><td>'
																+ dateStr
																+ '</td></tr>');

											});
						});

		$('#phonescheck')
				.click(
						function() {
							var phones = $('#phones');
							var phoneRule = $('#phoneRule').val();
							var procductCode = $('#ordersource').val();
							var province=$('#province_code').find("option:selected").val()
							var url = "/coreorder/qryPhones"
							// 			/*[[@{/klanBiliBili/qryPhones}]]*/'';
							var phone = [];
							$.ajax({
								type : 'get',
								async : false,
								url : url + "?phoneRule=" + phoneRule
										+ "&procductCode=" + procductCode+"&province="+province,
								success : function(resp) {
									phone = resp;
								}
							});
							$('.text-c').remove();
							$
									.each(
											phone,
											function() {
												var dateStr = formatTime(this.last_date)
												phones
														.append('<tr class="text-c"><td><input type="radio" value="'+this.phone+'"  name="phonesNum"/></td><td>'
																+ this.phone
																+ '</td><td>'
																+ this.rule_name
																+ '</td><td>'
																+ this.province_name
																+ '</td><td>'
																+ this.city_name
																+ '</td><td>'
																+ dateStr
																+ '</td></tr>');

											});
						});

		$('body').on("click", "input[name='phonesNum']", function(event) {
			var smsstatus = $(this).val();
			$("#phone_Num").val(smsstatus);

		});

		$('#id-disable-check')
				.click(
						function() {
							var phones = $('#phones');
							var procductCode = $('#ordersource').val();
							var procductName = $('#ordersource').find(
									"option:selected").text();
							var url = "/coreorder/qryPhonesNum"
							// 			var url=/*[[@{/klanBiliBili/qryPhonesNum}]]*/'';
							var phone = [];
							var phoneNum = $('#phoneNum').val();
							$
									.ajax({
										type : 'get',
										async : false,
										url : url + "?phoneNum=" + phoneNum
												+ "&procductCode="
												+ procductCode
												+ "&procductName="
												+ procductName,
										success : function(resp) {
											if (resp.status == 201) {
												parent.layer.alert(resp.msg,
														'尾号匹配失败')
												return;
											} else {
												phone = resp;
												$('.text-c').remove();
												$
														.each(
																phone,
																function() {
																	var dateStr = formatTime(this.last_date)
																	phones
																			.append('<tr class="text-c"><td><input type="radio" value="'+this.phone+'"  name="phonesNum"/></td><td>'
																					+ this.phone
																					+ '</td><td>'
																					+ this.rule_name
																					+ '</td><td>'
																					+ this.province_name
																					+ '</td><td>'
																					+ this.city_name
																					+ '</td><td>'
																					+ dateStr
																					+ '</td></tr>');

																});
											}

										}
									});

						});
	</script>
	<!--/请在上方写此页面业务相关的脚本-->
</body>
</html>